---
title: "Trending_YouTube_Video_Exploration"
author: "YuzheHuang"
date: "Dec. 14 2019"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE)
setwd("C:/Users/huang/Desktop/BU/678project")
library("ggplot2")
library(rjson)
library(jsonlite)
library(tidyverse)
library(RColorBrewer)
library(scales)
#Import data and data cleaning
us<-read.csv("US.csv",header = TRUE)
uscategory<-fromJSON("US_category_id.json")

ca<-read.csv("CA.csv",header = TRUE)
cacategory<-fromJSON("CA_category_id.json")

de<-read.csv("DE.csv",header = TRUE)
decategory<-fromJSON("DE_category_id.json")

fr<-read.csv("FR.csv",header = TRUE)
frcategory<-fromJSON("FR_category_id.json")

gb<-read.csv("GB.csv",header = TRUE)
gbcategory<-fromJSON("GB_category_id.json")

ind<-read.csv("IN.csv",header = TRUE)
indcategory<-fromJSON("IN_category_id.json")

jp<-read.csv("JP.csv",header = TRUE)
jpcategory<-fromJSON("JP_category_id.json")

kr<-read.csv("KR.csv",header = TRUE)
krcategory<-fromJSON("KR_category_id.json")

mx<-read.csv("MX.csv",header = TRUE)
mxcategory<-fromJSON("MX_category_id.json")

ru<-read.csv("RU.csv",header = TRUE)
rucategory<-fromJSON("RU_category_id.json")

category_id<-as.vector(uscategory$items$id)
category_name<-as.vector(uscategory$items$snippet$title)
uscategoryname<-as.data.frame(cbind(category_id,category_name))
uscategoryname$category_id<-as.numeric(levels(uscategoryname$category_id))[uscategoryname$category_id]
uss<-us%>%left_join(uscategoryname,by="category_id")

category_id<-as.vector(cacategory$items$id)
category_name<-as.vector(cacategory$items$snippet$title)
cacategoryname<-as.data.frame(cbind(category_id,category_name))
cacategoryname$category_id<-as.numeric(levels(cacategoryname$category_id))[cacategoryname$category_id]
cas<-ca%>%left_join(cacategoryname,by="category_id")
cas<-cas[,-c(9:34)]
cas<-cas[!is.na(cas$category_name),]


category_id<-as.vector(decategory$items$id)
category_name<-as.vector(decategory$items$snippet$title)
decategoryname<-as.data.frame(cbind(category_id,category_name))
decategoryname$category_id<-as.numeric(levels(decategoryname$category_id))[decategoryname$category_id]
des<-de%>%left_join(decategoryname,by="category_id")
des<-des[,-c(9:34)]


category_id<-as.vector(frcategory$items$id)
category_name<-as.vector(frcategory$items$snippet$title)
frcategoryname<-as.data.frame(cbind(category_id,category_name))
frcategoryname$category_id<-as.numeric(levels(frcategoryname$category_id))[frcategoryname$category_id]
fr$category_id<-as.numeric(fr$category_id)
frs<-fr%>%left_join(frcategoryname,by="category_id")
frs<-frs[!is.na(frs$category_name),]
frs<-frs[,-c(9:47)]


category_id<-as.vector(gbcategory$items$id)
category_name<-as.vector(gbcategory$items$snippet$title)
gbcategoryname<-as.data.frame(cbind(category_id,category_name))
gbcategoryname$category_id<-as.numeric(levels(gbcategoryname$category_id))[gbcategoryname$category_id]
gbs<-gb%>%left_join(gbcategoryname,by="category_id")
gbs<-gbs[,-c(9:34)]


category_id<-as.vector(indcategory$items$id)
category_name<-as.vector(indcategory$items$snippet$title)
indcategoryname<-as.data.frame(cbind(category_id,category_name))
indcategoryname$category_id<-as.numeric(levels(indcategoryname$category_id))[indcategoryname$category_id]
ind$category_id<-as.numeric(ind$category_id)
inds<-ind%>%left_join(indcategoryname,by="category_id")
inds<-inds[!is.na(inds$category_name),]
inds<-inds[,-c(9:26)]



category_id<-as.vector(jpcategory$items$id)
category_name<-as.vector(jpcategory$items$snippet$title)
jpcategoryname<-as.data.frame(cbind(category_id,category_name))
jpcategoryname$category_id<-as.numeric(levels(jpcategoryname$category_id))[jpcategoryname$category_id]
jp$category_id<-as.numeric(jp$category_id)
jps<-jp%>%left_join(jpcategoryname,by="category_id")


category_id<-as.vector(krcategory$items$id)
category_name<-as.vector(krcategory$items$snippet$title)
krcategoryname<-as.data.frame(cbind(category_id,category_name))
krcategoryname$category_id<-as.numeric(levels(krcategoryname$category_id))[krcategoryname$category_id]
kr$category_id<-as.numeric(kr$category_id)
krs<-kr%>%left_join(krcategoryname,by="category_id")
krs<-krs[,-c(9:41)]


category_id<-as.vector(mxcategory$items$id)
category_name<-as.vector(mxcategory$items$snippet$title)
mxcategoryname<-as.data.frame(cbind(category_id,category_name))
mxcategoryname$category_id<-as.numeric(levels(mxcategoryname$category_id))[mxcategoryname$category_id]
mx$category_id<-as.numeric(mx$category_id)
mxs<-mx%>%left_join(mxcategoryname,by="category_id")
mxs<-mxs[,-c(9:37)]


category_id<-as.vector(rucategory$items$id)
category_name<-as.vector(rucategory$items$snippet$title)
rucategoryname<-as.data.frame(cbind(category_id,category_name))
rucategoryname$category_id<-as.numeric(levels(rucategoryname$category_id))[rucategoryname$category_id]
ru$category_id<-as.numeric(ru$category_id)
rus<-ru%>%left_join(rucategoryname,by="category_id")
rus<-rus[,-c(9:37)]



```
Key Takeaways
==================
* View Pattern:
Entertainment, music, gaming and auto gain most popularity in 10 countries.

* User Participation:
The average voting rate, 3% of ten countries is 10 times of the average comment rate,0.3%.

* Trending Lifecycle:
The time interval of both going-viral and keeping trending ranges from 1 day to 2 weeks.

* Category Selection:
Entertainment, music, film and animation have the most business potential based on overall performance.

* Deep Dive to the Algorithm of Trending Videos:
Views, voting rate and comment rate will affect the going-viral days, and have different influence mechanism within different countries, especially U.S. and UK. 

Introduction
================
YouTube is one of the largest video hosting websites in the world, which has profound influences on the society in all aspects. Therefore, analyzing of YouTube’s dataset become significant for advertisers and investors to analyze the social trends and make a prediction for future strategic business planning. 

<br>

** Therefore, the key objectives of the report are as follows: **

* Find the view patterns of YouTube videos by region;
* Select the category that have relatively higher business potential by constructing evaluation matrix;
* Explore the algorithm of the YouTube trending charts.


Data Description
=================
**Datasets**

* The dataset includes daily trending YouTube videos of 10 countries: United States, United Kingdom, Germany, Canada, France, Japan, Korea, Mexico, Russia and India.
* Trending time interval: 2017.11-2018.6.
* The variables used contain: video id, trending date, category id, category name, publish time, views, likes, dislikes, comment count.  
* Source: https://www.kaggle.com/datasnaek/youtube-new#header

**Data Processing**

* Drop null values and corrected time format;
* Pair the category ids with their names for further analysis.

Exploratory Data Analysis
==================
1. View pattern
1.1 Top 5 Most Viewed YouTube Categories (by country)
--------------

* Entertainment videos are most viewed in six out of ten countries (Figure 1-6), followed by music videos dominated both in UK and U.S. (Figure 7,8).
* Indian viewers like auto and vehicle videos best (Figure 9), while French prefer game streaming (Figure 10).
```{r}
##Korea
category_view<-krs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 1. Korea")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Russia
category_view<-rus%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-11,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 2. Russia")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Germany
category_view<-des%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 3. Germany")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Mexico
category_view<-mxs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 4. Mexico")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Japan
category_view<-jps%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-15,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 5. Japan")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Canada
category_view<-cas%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 6. Canada")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Great Britain
category_view<-gbs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[-13,]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 7. United Kingdom")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 
ggsave("gb_trending_views_bar_all.png",height = 10,width = 10)

##us
category_view<-summarise(group_by(uss,category_name),sum(as.numeric(views)))
category_view<-category_view[order(category_view$`sum(as.numeric(views))`,decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$`sum(as.numeric(views))`),y=category_view$`sum(as.numeric(views))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 8. United States")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##India
category_view<-inds%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 9. India")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##France
category_view<-frs%>%group_by(category_name)%>%summarise(count=sum(as.numeric(views)))
category_view<-category_view[order((category_view$count),decreasing = TRUE),]
category_view<-category_view[1:5,]
ggplot(category_view,aes(x=reorder(category_name,-category_view$count),y=category_view$count))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 10. France")+
  labs(x="Category", y="Views")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 


```

1. View pattern
1.2 Top 5 Most Rated YouTube Categories (by country)   
-----------------------
* In terms of likes and dislikes, similarly, videos regarding to entertainment (Figure 11-13), music (Figure 14-17), gaming and auto (Figure 18-20)gain most popularity.
* The percentage of dislikes in music videos is generally lower than that in other three Top 1 genres, which indicates that music videos are more acceptable than others and thus a “safe” choice for advertiser.
*(Nearly 200 years ago, Henry Wadsworth Longfellow asserted "Music is the universal Language of mankind.")*

```{r}
##Korea
category_likes<-summarise(group_by(krs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(krs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 11. Korea")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Mexico
category_likes<-summarise(group_by(mxs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(mxs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 12. Mexico")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Canada
category_likes<-summarise(group_by(cas,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(cas,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 13. Canada")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##us
category_likes<-summarise(group_by(uss,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(uss,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 14. United States")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Russia
category_likes<-summarise(group_by(rus,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(rus,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 15. Russia")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##Germany
category_likes<-summarise(group_by(des,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(des,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 16. Germany")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))


##Japan
category_likes<-summarise(group_by(jps,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(jps,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 17. Japan")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##United Kingdom
category_likes<-summarise(group_by(gbs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(gbs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 18. United Kindom")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##India
category_likes<-summarise(group_by(inds,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(inds,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 19. India")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

##France
category_likes<-summarise(group_by(frs,category_name),sum(as.numeric(likes)))
category_dislikes<-summarise(group_by(frs,category_name),sum(as.numeric(dislikes)))
likerate<-category_likes%>%left_join(category_dislikes,by="category_name")
likerate<-mutate(likerate,rate=percent(likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`),digits = 2,sep=""),ratee=likerate$`sum(as.numeric(likes))`/(likerate$`sum(as.numeric(likes))`+likerate$`sum(as.numeric(dislikes))`))
colnames(likerate)[2]<-"likes"
colnames(likerate)[3]<-"dislikes"
likerate<-mutate(likerate,ld<-likes+dislikes)
colnames(likerate)[6]<-"ld"
ld<-likerate%>%gather(likes,dislikes,key="Attitude",value="clicks")
ld<-ld[order(ld$ld,decreasing = TRUE),]
ld<-ld[1:10,]
ggplot(ld,mapping = aes(x=reorder(category_name,-ld),clicks,fill=Attitude))+geom_bar(stat="identity",position='stack')+labs(title="Figure 20. France")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+labs(x="Category", y="Likes and Dislikes")+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+scale_fill_manual(values=c('black', brewer.pal(11, "RdBu")[2]))+theme(plot.title = element_text(hjust = 0.5))

```

1. View pattern
1.3 Top 5 Most Commented YouTube Categories (by country)   
-----------------------
* Entertainment (Figure 21-24), music (Figure 25-28), gaming and auto videos’(Figure 29-30) influence continues…

```{r }
##Russia
category_comments<-summarise(group_by(rus,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 21. Russia")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Germany
category_comments<-summarise(group_by(des,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 22. Germany")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Mexico
category_comments<-summarise(group_by(mxs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 23. Mexico")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Canada
category_comments<-summarise(group_by(cas,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 24. Canada")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##us
category_comments<-summarise(group_by(uss,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 25. United States")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Great Britain
category_comments<-summarise(group_by(gbs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 26. United Kingdom")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Japan
category_comments<-summarise(group_by(jps,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 27. Japan")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##Korea
category_comments<-summarise(group_by(krs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 28. Korea")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##France
category_comments<-summarise(group_by(frs,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 29. France")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())

##India
category_comments<-summarise(group_by(inds,category_name),sum(as.numeric(comment_count)))
category_comments<-category_comments[order(category_comments$`sum(as.numeric(comment_count))`,decreasing = TRUE),]
category_comments<-category_comments[1:5,]
ggplot(category_comments,aes(x=reorder(category_name,-category_comments$`sum(as.numeric(comment_count))`),y=category_comments$`sum(as.numeric(comment_count))`))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 30. India")+
  labs(x="Category", y="Comments")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())


```

1. View pattern
1.4 Top 5 Most Popular YouTube Categories (by country)
-------------------
* Finally, according to the times that videos went on charts, the four categories (Entertainment, Music, Auto and Gaming, see Figure 31-39) still dominate, which indicates that the views, likes, dislikes and number of comments are correlated with whether a video goes on chart. 
* Besides, people and blog (Figure 40) videos gain ground in Russia. 

```{r }
##Korea
category_count<-krs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 31. Korea")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Germany
category_count<-des%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 32. Germany")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Mexico
category_count<-mxs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 33. Mexico")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Japan
category_count<-jps%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 34. Japan")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Canada
category_count<-cas%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 35. Canada")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##us
category_count<-uss%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 36. United States")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Uk
category_count<-gbs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 37. United Kingdom")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##India
category_count<-inds%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 38. India")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##France
category_count<-frs%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 39. France")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

##Russia
category_count<-rus%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
category_count_top5<-category_count[c(1:5),]
ggplot(category_count_top5,aes(x=reorder(category_name,-n),y=n))+ geom_bar(stat = "identity",fill = brewer.pal(11, "RdBu")[2])+labs(title="Figure 40. Russia")+
  labs(x="Category", y="Trending Times")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=20))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank()) 

```
2. User participation
-------------------
* User participation is broke down into two parts: 
  * showing their attitude to the videos, i.e. clicking “likes and dislikes”;
  * leaving comments on videos.
<br>
* The average voting rate, 3% of ten countries is 10 times of the average comment rate,0.3% (red lines in the figures below): 
  * Voting rate of a video=(likes+dislikes)/views X 100%;
  * Comment rate of a video=(# of comments)/views X 100%.
<br>
* The British show the least willingness to rate and comment on videos, while Russians are enthusiastic about doing so, which could be partly explained by culture difference.

```{r}
#Combine 10 contries' data into one data frame
country<-rep("us",length(uss$video_id))
usss<-cbind(uss,country)
country<-rep("ca",length(cas$video_id))
cass<-cbind(cas,country)
country<-rep("de",length(des$video_id))
dess<-cbind(des,country)
country<-rep("fr",length(frs$video_id))
frss<-cbind(frs,country)
country<-rep("gb",length(gbs$video_id))
gbss<-cbind(gbs,country)
country<-rep("ind",length(inds$video_id))
indss<-cbind(inds,country)
country<-rep("jp",length(jps$video_id))
jpss<-cbind(jps,country)
country<-rep("kr",length(krs$video_id))
krss<-cbind(krs,country)
country<-rep("mx",length(mxs$video_id))
mxss<-cbind(mxs,country)
country<-rep("ru",length(rus$video_id))
russ<-cbind(rus,country)
total<-rbind(usss,cass,dess,frss,gbss,indss,jpss,krss,mxss,russ)
total<-total[!is.na(total$category_name),]



#global
#Calculate comment/views and (likes+dislikes)/views 
total<-mutate(total,cv=as.numeric(comment_count)/as.numeric(views),av=(as.numeric(likes)+as.numeric(dislikes))/as.numeric(views))

total<-mutate(total,trending_year=substr(trending_date,1,2),trending_month=substr(trending_date,7,8))
total_month<-total%>%group_by(trending_year,trending_month)%>%summarise(comments_month=sum(as.numeric(comment_count),na.rm = TRUE),attitude_month=sum(as.numeric(likes)+as.numeric(dislikes),na.rm = TRUE),views_month=sum(as.numeric(views),na.rm = TRUE))
total_month<-mutate(total_month,cv=as.numeric(comments_month)/as.numeric(views_month),av=(as.numeric(attitude_month))/as.numeric(views_month))


#by region
total_month_region<-total%>%group_by(country,trending_year,trending_month)%>%summarise(comments_month=sum(as.numeric(comment_count),na.rm = TRUE),attitude_month=sum(as.numeric(likes)+as.numeric(dislikes),na.rm = TRUE),views_month=sum(as.numeric(views),na.rm = TRUE))
total_month_region<-mutate(total_month_region,cv=as.numeric(comments_month)/as.numeric(views_month),av=(as.numeric(attitude_month))/as.numeric(views_month))

total_month_region<-left_join(total_month_region,total_month,by=c("trending_year" , "trending_month"))

total_month_region<-mutate(total_month_region,date=paste(trending_year,trending_month,sep="-"))
total_month_region<-mutate(total_month_region,date=paste("20",date,sep=""))
colnames(total_month_region)[8]<-"av_region"
colnames(total_month_region)[7]<-"cv_region"
colnames(total_month_region)[12]<-"cv_global"
colnames(total_month_region)[13]<-"av_global"

ggplot(total_month_region)+geom_point(mapping=aes(x=as.character(date),y=av_region,color=country))+guides(color=guide_legend(title=NULL))+theme(legend.text = element_text(color="azure4", size = 8, face = "bold"))+theme(axis.text.x=element_text(size = 6))+geom_line(mapping = aes(x=as.character(date),y=av_global,group=1),size=2,colour=brewer.pal(11, "RdBu")[2])+theme(panel.background = element_rect(fill = "transparent",colour = NA),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+labs(title="Figure 41. Average Voting Rate")+
  labs(x="Time", y="Average Voting Rate") +scale_color_discrete(labels = c('United States','Canada','Germany','France','United Kingdom','India','Japan','Korea','Mexico','Russia'))+annotate("text", x=8, y=0.028, label="Overall Voting Rate",colour=brewer.pal(11, "RdBu")[2])

ggplot(total_month_region)+geom_point(mapping=aes(x=as.character(date),y=cv_region,color=country))+guides(color=guide_legend(title=NULL))+theme(legend.text = element_text(color="azure4", size = 8, face = "bold"))+theme(axis.text.x=element_text(size = 6))+geom_line(mapping = aes(x=as.character(date),y=cv_global,group=1),size=2,colour=brewer.pal(11, "RdBu")[2])+theme(panel.background = element_rect(fill = "transparent",colour = NA),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10))+labs(title="Figure 42. Average Comment Rate")+
  labs(x="Time", y="Average Comment Rate") +scale_color_discrete(labels = c('United States','Canada','Germany','France','United Kingdom','India','Japan','Korea','Mexico','Russia'))+annotate("text", x=7, y=0.0025, label="Overall Comment Rate",colour=brewer.pal(11, "RdBu")[2])




```

3. Trending Lifecycle
-----------------------------
*"Trending lifecycle is from the moment the video is published to the last trending date on the charts"*
<br>
- **Metrics explanation**
  + I focus on two key time intervals: 
    * Average going-viral time=Initial trending date-publish date
    * Average trending days=Final trending date-Initial trending date
<br>
* The average going-viral time for each category describes on average how fast a video can show up on the trending charts. The longer time interval is, the larger the time cost will be.
* The average trending days for each category explain on average how long a video can keep attracting audience. The longer time interval is, the larger number of target customers will be.

- **Insights from visuals** 
- By country
  + Average going-viral time: In most countries, it took **1-3 days** for a video to go viral (Figure 41-48). However, in U.S and UK, it took **1-2 weeks** (Figure 49-50). 
  + Average trending days: It showed similar trend as the average going-viral time (Figure 51-60).
<br>
- By category
  + Average going viral time: Music videos take the longest time to go viral on YouTube. This may explained by the fact that:
    * Music videos normally lack breath-taking storylines, so they take time to attract audience;
    * There exist other more focused music video platforms, like Vimeo and TikTok, making audience switching to them.
  + Average trending days:  Shows and movies are outstanding among all categories.

```{r}
#Trending Lifecycle
##publish to initial trending
#Japan
jpd<-jp%>%mutate(p1<-paste(str_sub(as.character(jp$trending_date),1,2),str_sub(as.character(jp$trending_date),7,8),str_sub(as.character(jp$trending_date),4,5),sep="-"))
jpd<-jpd%>%mutate(p2<-paste("20",jpd$`... <- NULL`,sep = ""))
colnames(jpd)[9]<-"trendingdate"
colnames(jpd)[10]<-"trending_date_final"

jpd<-mutate(jpd,pub<-substr(publish_time,1,10))
colnames(jpd)[11]<-"pub"
jpd$pub<-as.Date(jpd$pub)
jpd<-mutate(jpd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(jpd$gov)[2])
q3<-as.vector(summary(jpd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

jpdgov_prep<-jpd[-as.vector(which(jpd$gov>shangjie)),]
jpgov<-jpdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
jpgov<-left_join(jpgov,cacategoryname,by="category_id")
jpgov<-jpgov[-15,]

ggplot(jpgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 41. Japan")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Russia
rud<-ru%>%mutate(p1<-paste(str_sub(as.character(ru$trending_date),1,2),str_sub(as.character(ru$trending_date),7,8),str_sub(as.character(ru$trending_date),4,5),sep="-"))
rud<-rud%>%mutate(p2<-paste("20",rud$`... <- NULL`,sep = ""))
rud<-rud[,-c(9:37)]
colnames(rud)[9]<-"trendingdate"
colnames(rud)[10]<-"trending_date_final"

rud<-mutate(rud,pub<-substr(publish_time,1,10))
colnames(rud)[11]<-"pub"
rud$pub<-as.Date(rud$pub)
rud<-mutate(rud,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(rud$gov)[2])
q3<-as.vector(summary(rud$gov)[5])
shangjie<-q3+1.5*(q3-q1)

rudgov_prep<-rud[-as.vector(which(rud$gov>shangjie)),]
rugov<-rudgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
rugov<-left_join(rugov,cacategoryname,by="category_id")
rugov<-rugov[-15,]

ggplot(rugov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 42. Russia")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#France
frd<-fr%>%mutate(p1<-paste(str_sub(as.character(fr$trending_date),1,2),str_sub(as.character(fr$trending_date),7,8),str_sub(as.character(fr$trending_date),4,5),sep="-"))
frd<-frd%>%mutate(p2<-paste("20",frd$`... <- NULL`,sep = ""))
frd<-frd[,-c(9:47)]
colnames(frd)[9]<-"trendingdate"
colnames(frd)[10]<-"trending_date_final"


frd<-mutate(frd,pub<-substr(publish_time,1,10))
colnames(frd)[11]<-"pub"
frd$pub<-as.Date(frd$pub)
frd<-mutate(frd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(frd$gov)[2])
q3<-as.vector(summary(frd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

frdgov_prep<-frd[-as.vector(which(frd$gov>shangjie)),]
frgov<-frdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
frgov$category_id<-as.numeric(frgov$category_id)
frgov<-left_join(frgov,cacategoryname,by="category_id")
frgov<-frgov[!is.na(frgov$govtime),]
frgov<-frgov[!is.na(frgov$category_name),]

ggplot(frgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 43. France")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Mexico
mxd<-mx%>%mutate(p1<-paste(str_sub(as.character(mx$trending_date),1,2),str_sub(as.character(mx$trending_date),7,8),str_sub(as.character(mx$trending_date),4,5),sep="-"))
mxd<-mxd%>%mutate(p2<-paste("20",mxd$`... <- NULL`,sep = ""))
mxd<-mxd[,-c(9:37)]
colnames(mxd)[9]<-"trendingdate"
colnames(mxd)[10]<-"trending_date_final"



mxd<-mutate(mxd,pub<-substr(publish_time,1,10))
colnames(mxd)[11]<-"pub"
mxd$pub<-as.Date(mxd$pub)
mxd<-mutate(mxd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(mxd$gov)[2])
q3<-as.vector(summary(mxd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

mxdgov_prep<-mxd[-as.vector(which(mxd$gov>shangjie)),]
mxgov<-mxdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
mxgov<-left_join(mxgov,cacategoryname,by="category_id")
mxgov<-mxgov[-15,]

ggplot(mxgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 44. Mexico")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Germany
ded<-de%>%mutate(p1<-paste(str_sub(as.character(de$trending_date),1,2),str_sub(as.character(de$trending_date),7,8),str_sub(as.character(de$trending_date),4,5),sep="-"))
ded<-ded%>%mutate(p2<-paste("20",ded$`... <- NULL`,sep = ""))
ded<-ded[,-c(9:34)]
colnames(ded)[9]<-"trendingdate"
colnames(ded)[10]<-"trending_date_final"



ded<-mutate(ded,pub<-substr(publish_time,1,10))
colnames(ded)[11]<-"pub"
ded$pub<-as.Date(ded$pub)
ded<-mutate(ded,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(ded$gov)[2])
q3<-as.vector(summary(ded$gov)[5])
shangjie<-q3+1.5*(q3-q1)

dedgov_prep<-ded[-as.vector(which(ded$gov>shangjie)),]
degov<-dedgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
degov<-left_join(degov,cacategoryname,by="category_id")

ggplot(degov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 45. Germany")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))


#canada
cad<-ca%>%mutate(p1<-paste(str_sub(as.character(ca$trending_date),1,2),str_sub(as.character(ca$trending_date),7,8),str_sub(as.character(ca$trending_date),4,5),sep="-"))
cad<-cad%>%mutate(p2<-paste("20",cad$`... <- NULL`,sep = ""))
cad<-cad[,-c(9:34)]
colnames(cad)[9]<-"trendingdate"
colnames(cad)[10]<-"trending_date_final"

cad<-mutate(cad,pub<-substr(publish_time,1,10))
colnames(cad)[11]<-"pub"
cad$pub<-as.Date(cad$pub)
cad<-mutate(cad,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(cad$gov)[2])
q3<-as.vector(summary(cad$gov)[5])
shangjie<-q3+1.5*(q3-q1)

cadgov_prep<-cad[-as.vector(which(cad$gov>shangjie)),]
cagov<-cadgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
cagov<-left_join(cagov,cacategoryname,by="category_id")

ggplot(cagov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 46. Canada")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Korea
krd<-kr%>%mutate(p1<-paste(str_sub(as.character(kr$trending_date),1,2),str_sub(as.character(kr$trending_date),7,8),str_sub(as.character(kr$trending_date),4,5),sep="-"))
krd<-krd%>%mutate(p2<-paste("20",krd$`... <- NULL`,sep = ""))
krd<-krd[,-c(9:41)]
colnames(krd)[9]<-"trendingdate"
colnames(krd)[10]<-"trending_date_final"


krd<-mutate(krd,pub<-substr(publish_time,1,10))
colnames(krd)[11]<-"pub"
krd$pub<-as.Date(krd$pub)
krd<-mutate(krd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(krd$gov)[2])
q3<-as.vector(summary(krd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

krdgov_prep<-krd[-as.vector(which(krd$gov>shangjie)),]
krgov<-krdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
krgov<-left_join(krgov,cacategoryname,by="category_id")
krgov<-krgov[-15,]

ggplot(krgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 47. Korea")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#India
indd<-ind%>%mutate(p1<-paste(str_sub(as.character(ind$trending_date),1,2),str_sub(as.character(ind$trending_date),7,8),str_sub(as.character(ind$trending_date),4,5),sep="-"))
indd<-indd%>%mutate(p2<-paste("20",indd$`... <- NULL`,sep = ""))
indd<-indd[,-c(9:26)]
colnames(indd)[9]<-"trendingdate"
colnames(indd)[10]<-"trending_date_final"



indd<-mutate(indd,pub<-substr(publish_time,1,10))
colnames(indd)[11]<-"pub"
indd$pub<-as.Date(indd$pub)
indd<-mutate(indd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(indd$gov)[2])
q3<-as.vector(summary(indd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

inddgov_prep<-indd[-as.vector(which(indd$gov>shangjie)),]
indgov<-inddgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
indgov<-left_join(indgov,cacategoryname,by="category_id")
indgov<-indgov[!is.na(indgov$category_name),]

ggplot(indgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 48. India")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#us
usd<-us%>%mutate(p1<-paste(str_sub(as.character(us$trending_date),1,2),str_sub(as.character(us$trending_date),7,8),str_sub(as.character(us$trending_date),4,5),sep="-"))
usd<-usd%>%mutate(p2<-paste("20",usd$`... <- NULL`,sep = ""))
colnames(usd)[9]<-"trendingdate"
usd<-usd%>%mutate(as.Date(trendingdate))
colnames(usd)[10]<-"trending_date_final"


usd<-mutate(usd,pub<-substr(publish_time,1,10))
colnames(usd)[12]<-"pub"
usd$pub<-as.Date(usd$pub)
usd<-mutate(usd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(usd$gov)[2])
q3<-as.vector(summary(usd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

usdgov_prep<-usd[-as.vector(which(usd$gov>shangjie)),]
usgov<-usdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
usgov<-left_join(usgov,uscategoryname,by="category_id")

ggplot(usgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 49. United States")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#UK
gbd<-gb%>%mutate(p1<-paste(str_sub(as.character(gb$trending_date),1,2),str_sub(as.character(gb$trending_date),7,8),str_sub(as.character(gb$trending_date),4,5),sep="-"))
gbd<-gbd%>%mutate(p2<-paste("20",gbd$`... <- NULL`,sep = ""))
gbd<-gbd[,-c(9:34)]
colnames(gbd)[9]<-"trendingdate"
colnames(gbd)[10]<-"trending_date_final"




gbd<-mutate(gbd,pub<-substr(publish_time,1,10))
colnames(gbd)[11]<-"pub"
gbd$pub<-as.Date(gbd$pub)
gbd<-mutate(gbd,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
q1<-as.vector(summary(gbd$gov)[2])
q3<-as.vector(summary(gbd$gov)[5])
shangjie<-q3+1.5*(q3-q1)

gbdgov_prep<-gbd[-as.vector(which(gbd$gov>shangjie)),]
gbgov<-gbdgov_prep%>%group_by(category_id)%>%summarise(govtime=round(mean(gov),digits = 0))
gbgov<-left_join(gbgov,cacategoryname,by="category_id")

ggplot(gbgov,aes(x=reorder(category_name,-govtime),y=govtime,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 50. United Kingdom")+
  labs(x="Category", y="Average Going-Viral Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = govtime, vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

##initial trending to final trending: Calculate Trending days
#UK
gb_trending_lifecycle<-data.frame()
for (i in c(1:length(gbd$video_id))) {
  hangshu<-which(gbd$video_id==gbd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(gbd$trending_date_final[fuyi],gbd$trending_date_final[yi]))
  gb_trending_lifecycle[i,1]<-gbd$video_id[i]
  gb_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-gb_trending_lifecycle[!duplicated(gb_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,gbs,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-15,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 51. United Kindom")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))


#us
us_trending_lifecycle<-data.frame()
for (i in c(1:length(usd$video_id))) {
  hangshu<-which(usd$video_id==usd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(usd$trending_date_final[fuyi],usd$trending_date_final[yi]))
  us_trending_lifecycle[i,1]<-usd$video_id[i]
  us_trending_lifecycle[i,2]<-tt
  
}
trending_lifecycle_dup<-us_trending_lifecycle[!duplicated(us_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,uss,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 52. United States")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#ca
ca_trending_lifecycle<-data.frame()
for (i in c(1:length(cad$video_id))) {
  hangshu<-which(cad$video_id==cad$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(cad$trending_date_final[fuyi],cad$trending_date_final[yi]))
  ca_trending_lifecycle[i,1]<-cad$video_id[i]
  ca_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-ca_trending_lifecycle[!duplicated(ca_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,cas,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-11,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 53. Canada")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#India
ind_trending_lifecycle<-data.frame()
for (i in c(1:length(indd$video_id))) {
  hangshu<-which(indd$video_id==indd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(indd$trending_date_final[fuyi],indd$trending_date_final[yi]))
  ind_trending_lifecycle[i,1]<-indd$video_id[i]
  ind_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-ind_trending_lifecycle[!duplicated(ind_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,inds,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-2,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 54. India")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#France
fr_trending_lifecycle<-data.frame()
for (i in c(1:length(frd$video_id))) {
  hangshu<-which(frd$video_id==frd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(frd$trending_date_final[fuyi],frd$trending_date_final[yi]))
  fr_trending_lifecycle[i,1]<-frd$video_id[i]
  fr_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-fr_trending_lifecycle[!duplicated(fr_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,frs,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-1,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 55. France")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Korea
kr_trending_lifecycle<-data.frame()
for (i in c(1:length(krd$video_id))) {
  hangshu<-which(krd$video_id==krd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(krd$trending_date_final[fuyi],krd$trending_date_final[yi]))
  kr_trending_lifecycle[i,1]<-krd$video_id[i]
  kr_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-kr_trending_lifecycle[!duplicated(kr_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,krs,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-15,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 56. Korea")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))


#Germany
de_trending_lifecycle<-data.frame()
for (i in c(1:length(ded$video_id))) {
  hangshu<-which(ded$video_id==ded$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(ded$trending_date_final[fuyi],ded$trending_date_final[yi]))
  de_trending_lifecycle[i,1]<-ded$video_id[i]
  de_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-de_trending_lifecycle[!duplicated(de_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,des,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-14,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 57. Germany")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))


#Mexico
mx_trending_lifecycle<-data.frame()
for (i in c(1:length(mxd$video_id))) {
  hangshu<-which(mxd$video_id==mxd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(mxd$trending_date_final[fuyi],mxd$trending_date_final[yi]))
  mx_trending_lifecycle[i,1]<-mxd$video_id[i]
  mx_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-mx_trending_lifecycle[!duplicated(mx_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,mxs,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-15,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 58. Mexico")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

#Russia
ru_trending_lifecycle<-data.frame()
for (i in c(1:length(rud$video_id))) {
  hangshu<-which(rud$video_id==rud$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(rud$trending_date_final[fuyi],rud$trending_date_final[yi]))
  ru_trending_lifecycle[i,1]<-rud$video_id[i]
  ru_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-ru_trending_lifecycle[!duplicated(ru_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,rus,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"
category_count_lifecycle_ca<-category_count_lifecycle_ca[-15,]

ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 59. Russia")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))


#Japan
jp_trending_lifecycle<-data.frame()
for (i in c(1:length(jpd$video_id))) {
  hangshu<-which(jpd$video_id==jpd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(jpd$trending_date_final[fuyi],jpd$trending_date_final[yi]))
  jp_trending_lifecycle[i,1]<-jpd$video_id[i]
  jp_trending_lifecycle[i,2]<-tt
}

trending_lifecycle_dup<-jp_trending_lifecycle[!duplicated(jp_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,jps,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"


ggplot(category_count_lifecycle_ca,aes(x=reorder(category_name,-tianshu),y=tianshu,group=1))+ geom_line(size=2,colour=brewer.pal(11, "RdBu")[2])+geom_point()+labs(title="Figure 60. Japan")+
  labs(x="Category", y="Average Trending Days")+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour="black"))+theme(plot.title = element_text(hjust = 0.5))+theme(axis.text.x=element_text(size=10,angle = 90))+theme(axis.text.y = element_blank())+theme(axis.ticks.y = element_blank())+geom_text(aes(label = round(tianshu,digits = 2), vjust = -1, hjust =0.5))+theme(title=element_text(size=20))

```





4. Category Selection
-----------------------------
- **Method**
  + In the evaluation matrix, I took view pattern, user participation and trending lifecycle into account and pick the variables below.
  + Used the reverse ranking of each attribute as its score for categories, and then summed up all the scores to get a final score of each category to select most valuable category to do further analysis.


```{r}
#Take U.S. as example
#ranking by views



category_count<-uss%>%count(category_name)
category_count<-category_count[order(category_count$n,decreasing = TRUE),]
us_category_count<-mutate(category_count,ranking=rank(n))

#ranking by voting rate and comment rate 
us_cv_rate_ranking<-uss%>%group_by(category_name)%>%summarise(sum(likes),sum(dislikes),sum(comment_count),sum(as.numeric(views)))
colnames(us_cv_rate_ranking)<-c("category_name","likes","dislikes","comments", "views")
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,av=(likes+dislikes)/views,cv=comments/views)
us_cv_rate_ranking<-us_cv_rate_ranking[order(us_cv_rate_ranking$av,decreasing = TRUE),]
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,cv_ranking=rank(av))

us_cv_rate_ranking<-us_cv_rate_ranking[order(us_cv_rate_ranking$cv,decreasing = TRUE),]
us_cv_rate_ranking<-mutate(us_cv_rate_ranking,cv_ranking=rank(cv))



#ranking by going-viral time
usgov<-usgov[order(usgov$govtime),]
usgov<-mutate(usgov,gv_ranking=length(govtime)-rank(govtime)+1 )

#ranking by trending days
us_trending_lifecycle<-data.frame()
for (i in c(1:length(usd$video_id))) {
  hangshu<-which(usd$video_id==usd$video_id[i])
  yi<-as.numeric(hangshu[1])
  fuyi<-as.numeric(hangshu[length(hangshu)])
  tt<-as.numeric(difftime(usd$trending_date_final[fuyi],usd$trending_date_final[yi]))
  us_trending_lifecycle[i,1]<-usd$video_id[i]
  us_trending_lifecycle[i,2]<-tt
  
}
trending_lifecycle_dup<-us_trending_lifecycle[!duplicated(us_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,uss,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"




trending_lifecycle_dup<-us_trending_lifecycle[!duplicated(us_trending_lifecycle$V1), ]
colnames(trending_lifecycle_dup)[1]<-"video_id"
trending_lifecycle_ca<-left_join(trending_lifecycle_dup,uss,by="video_id")
trending_lifecycle_ca<-trending_lifecycle_ca[!duplicated(trending_lifecycle_ca$video_id), ]

category_count_lifecycle<-trending_lifecycle_ca%>%group_by(category_name)%>%mutate(avg_lifecycle<-mean(sum(V2)/length(video_id)))
category_count_lifecycle_ca<-category_count_lifecycle%>%select(-c(1:9))
category_count_lifecycle_ca<-category_count_lifecycle_ca[!duplicated(category_count_lifecycle_ca$`avg_lifecycle <- mean(sum(V2)/length(video_id))`),]
colnames(category_count_lifecycle_ca)[2]<-"tianshu"

us_trending_days<-category_count_lifecycle_ca[order(category_count_lifecycle_ca$tianshu,decreasing = TRUE),]
a<-rank(us_trending_days$tianshu)
us_trending_days<-mutate(us_trending_days,us_trending_days_ranking=rank(tianshu))
us_trending_days$us_trending_days_ranking<-a

#Construct evaluation matrix
us_matrix<-left_join(us_category_count,us_cv_rate_ranking,by="category_name")
us_matrix<-us_matrix[,-c(4:9)]
us_matrix<-left_join(us_matrix,usgov,by="category_name")
us_matrix<-left_join(us_matrix,us_trending_days,by="category_name")
us_matrix<-us_matrix[,c(1,3,4,5,8,10)]
us_matrix<-mutate(us_matrix,total_score=ranking+av_ranking+cv_ranking+gv_ranking+us_trending_days_ranking)
us_matrix<-us_matrix[order(us_matrix$total_score,decreasing = TRUE),]
colnames(us_matrix)<-c("category_name","Views_ranking","VotingRate_ranking","CommentRate_ranking","GoingViralTime_ranking","TrendingDays_ranking","Total_Score")
as.tibble(us_matrix)
```

- **Findings**
  + In the U.S., **How to & Style, Gaming and Comedy** are among Top 3 popular categories based on evaluation matrix, which partlyly different from the previous EDA, i.e. music, entertainment and gaming videos’influence continues. 
  + **How to & Style and Comedy**  become new hitmakers and thus may be the next potential categories for advertisers.
  


Modelling
==================
Deep dive to the algorithm of trending chart
----------------------
**Questions of interest**
* How the number of views, likes, dislikes and comments influence the going-viral time?
* Is  the influence vary across different countries? 
<br>
**Method**
* Multilevel linear model with varying intercepts and slopes
* Predictors: Views (normalized because of scaling issues), Comment Rate (cv), Voting Rate (av)
* Response: Going-viral Days

<br>
**Result and Discussion**
* Basically, the higher voting rate, comment rate  and views would lead to shorter going-viral days.
* This influence varies across countries. Especially in U.S. and UK, the comment rate and voting rate play more important roles compared with other countries.
* In UK, since the intercept is largest, chances are are that there exist other more significant factors affecting the going-viral days.

```{r}
library(lme4)
total<-rbind(usss,cass,dess,frss,gbss,indss,jpss,krss,mxss,russ)
total<-total[!is.na(total$category_name),]
total<-total%>%mutate(p1<-paste(str_sub(as.character(total$trending_date),1,2),str_sub(as.character(total$trending_date),7,8),str_sub(as.character(total$trending_date),4,5),sep="-"))
total<-total%>%mutate(p2<-paste("20",total$`... <- NULL`,sep = ""))
colnames(total)[11]<-"trendingdate"
total<-total%>%mutate(as.Date(trendingdate))
colnames(total)[12]<-"trending_date_final"


total<-mutate(total,pub<-substr(publish_time,1,10))
colnames(total)[14]<-"pub"
total$pub<-as.Date(total$pub)
total<-mutate(total,gov=round(-as.numeric(difftime(pub,trending_date_final,units="days")),digits = 0))
total<-mutate(total,cv=as.numeric(comment_count)/as.numeric(views),av=(as.numeric(likes)+as.numeric(dislikes))/as.numeric(views))
totall<-total[!duplicated(total$video_id),]

totall$views<-as.numeric(totall$views)
totall<-mutate(totall,view_ct=(views-mean(views,na.rm=TRUE))/sd(views,na.rm = TRUE))

model3 <- lmer(gov~av+cv+view_ct+(1+av+cv+view_ct|country),data=totall)
coef(model3)$country

```
* Model checking: as is shown in the residual plot, there is no clear pattern. 

```{r}
#model checking
plot(model3)


```















